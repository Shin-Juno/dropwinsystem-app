<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dropwinsystem.app.mapper.BoardMapper">

	<select id="boardList" parameterType="map"
		resultType="com.dropwinsystem.app.domain.Board">
		SELECT
		ROW_NUMBER() OVER (ORDER BY no ASC) AS displayNo,
		no,
		title,
		content,
		read_count AS readCount,
		reg_date AS regDate,
		file1,
		pass,
		is_board AS isBoard,
		recommend,
		name
		FROM board
		WHERE is_board = FALSE
		<if test="keyword != null and keyword != ''">
			<if test="type == 'all'">
				AND (title LIKE CONCAT('%', #{keyword}, '%') OR content
				LIKE CONCAT('%', #{keyword}, '%'))
			</if>
			<if test="type == 'title'">
				AND title LIKE CONCAT('%', #{keyword}, '%')
			</if>
			<if test="type == 'content'">
				AND content LIKE CONCAT('%', #{keyword}, '%')
			</if>
		</if>
		ORDER BY no DESC
		LIMIT #{num} OFFSET #{startRow}
	</select>

	<select id="getIsBoards"
		resultType="com.dropwinsystem.app.domain.Board">
		SELECT
		no,
		title,
		content,
		read_count AS readCount,
		reg_date AS
		regDate,
		file1,
		pass,
		is_board AS isBoard,
		recommend,
		name
		FROM board
		WHERE
		is_board =
		TRUE
		ORDER BY no DESC
		LIMIT 3
	</select>

	<select id="getBoardCount" parameterType="map" resultType="int">
		SELECT COUNT(*) FROM board
		WHERE is_board = FALSE
		<if test="keyword != null and keyword != ''">
			<if test="type == 'all'">
				AND (title LIKE CONCAT('%', #{keyword}, '%') OR content
				LIKE CONCAT('%', #{keyword}, '%'))
			</if>
			<if test="type == 'title'">
				AND title LIKE CONCAT('%', #{keyword}, '%')
			</if>
			<if test="type == 'content'">
				AND content LIKE CONCAT('%', #{keyword}, '%')
			</if>
		</if>
	</select>

	<select id="getNoticeBoardCount" resultType="int">
		SELECT COUNT(*) FROM
		board WHERE is_board = TRUE
	</select>

	<select id="getBoard"
		resultType="com.dropwinsystem.app.domain.Board">
		SELECT
		no,
		title,
		content,
		read_count AS readCount,
		reg_date AS
		regDate,
		file1, pass, is_board AS isBoard,
		recommend,
		name
		FROM board
		WHERE no =
		#{no}
	</select>

	<insert id="insertBoard"
		parameterType="com.dropwinsystem.app.domain.Board">
		INSERT INTO board(title, content, read_count, reg_date,
		pass,
		file1, is_board, recommend, name)
		VALUES(#{title}, #{content}, #{readCount},
		SYSDATE(), #{pass}, #{file1},
		#{isBoard},
		#{recommend},
		#{name})
	</insert>

	<update id="updateReadCount" parameterType="int">
		UPDATE board SET
		read_count = read_count + 1 WHERE no = #{no}
	</update>

	<select id="getPrevBoard"
		resultType="com.dropwinsystem.app.domain.Board">
		SELECT no, title FROM board WHERE no &lt; #{no} ORDER BY
		no
		DESC LIMIT 1
	</select>

	<select id="getNextBoard"
		resultType="com.dropwinsystem.app.domain.Board">
		SELECT no, title FROM board WHERE no &gt; #{no} ORDER BY
		no
		ASC LIMIT 1
	</select>

	<update id="updateBoard"
		parameterType="com.dropwinsystem.app.domain.Board">
		UPDATE board
		SET
		title = #{title},
		content = #{content},
		file1 = #{file1},
		name = #{name}
		WHERE no = #{no}
	</update>

	<delete id="deleteBoard">
		DELETE FROM board
		WHERE no = #{no}
	</delete>
	
	<update id="updateRecommend" parameterType="map">
		UPDATE board
			SET
			<if test="recommend == 'commend'">		
				recommend=recommend + 1
			</if>
		WHERE no = #{no}
	</update>

	<select id="getRecommend" parameterType="int" resultType="com.dropwinsystem.app.domain.Board">
		SELECT recommend
		FROM board
		WHERE no = #{no}
	</select>

</mapper>